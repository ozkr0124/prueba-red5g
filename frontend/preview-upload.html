<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista previa</title>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>

    <header class="header-dashboard">
        <img src="./assets/images/logo-dark.png" style="cursor: pointer;" alt="" onclick="router_view('dashboard')">
        <div class="logout" onclick="logout()">
            <span class="material-icons-outlined icon24 m12">logout</span>
            <span class="label-logout">Log Out</span>
        </div>
    </header>
    <main>

        <div class="container-title-view">
            <div class="title-view">Vista previa</div>
            <button type="button" class="button-large" id="btnSave" onclick="approved_upload()">Guardar</button>
        </div>

        <div class="container-table">
        </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./assets/js/script.js"></script>

    <script>
        $(async function () {
            try {

                const paramsString = location.search;
                const queryParams = new URLSearchParams(paramsString);
                const ticket = queryParams.get('ticket');
                const type = queryParams.get('type');

                let options = {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-token': window.sessionStorage.getItem('token'),
                    },
                }

                let pathUrl = (type == 'pending') ? `preview-upload-pending?ticket=${ticket}` : `preview-upload-confirmation?ticket=${ticket}`;

                let fetchRes = await fetch(base_url + pathUrl, options).catch(error => console.error(error));
                let resdata = await fetchRes.json();
                
                if (resdata.type == 'error_token') {
                    await logout();
                    return false;
                }

                if (resdata.type == 'error') {
                    $('.container-table').html(
                        `<h1>${resdata.msg}</h1>`
                    );
                }

                let html = `<table class="table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Documento</th>
                            <th>Correo</th>
                            <th>Monto</th>
                            <th>Fecha pago</th>
                            <th>${(type == 'pending') ? 'Fecha limite': 'ID Pago'}</th>
                        </tr>
                    </thead>
                    <tbody>`;

                $.each(resdata.msg, function (index, val) {
                    html += `<tr>
                        <td>${val.customer_name}</td>
                        <td>${val.customer_document}</td>
                        <td>${val.customer_email}</td>
                        <td>${val.amount}</td>
                        <td>${val.payment_date}</td>
                        <td>${(type == 'pending') ? val.due_date : val.payment_id}</td>
                    </tr>`;
                });

                html += `</tbody>
                </table>`;


                $('.container-table').html(html);


            } catch (error) {
                console.log(resdata);
            }
        });
    </script>

</body>

</html>